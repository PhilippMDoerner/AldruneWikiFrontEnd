<div class="main">
    <article *ngIf="encounter; else loading">
        <h1 class="text-center">{{encounter.name}}</h1>
        <div class="mb-3">
            <!-- EncounterConnections -->
            <div class="d-flex">
                <span class="w-25 bold"> Session: </span>
                {{encounter.session_number_details.name_full}}
            </div>
            <div class="d-flex">
                <span class="w-25 bold">Location: </span> 
                <a routerLink="/location/{{encounter.location_details.parent_location_name}}/{{encounter.location_details.name}}">
                    {{encounter.location_details.name}}
                </a>
            </div>
            <div>
                <div class="w-25 bold icon-container">
                    Characters: 
                    <i class="fa fa-plus icon ml-1" (click)="toggleAddEncounterConnectionState()"></i>
                </div>
                <form [ngClass]="{'d-none':!addEncounterConnectionState, 'd-flex align-items-center': addEncounterConnectionState}">
                    <div class="mw-50 w-50">
                        <select class="form-control" name="character" id="character" [(ngModel)]="baseEncounterConnection.character">
                            <option *ngFor="let character of characters" value="{{character.pk}}">{{character.name}}</option>
                        </select>
                    </div>

                    <i [ngClass]="{'fa icon mx-2 fa-1-5x': true, 'fa-plus': !addEncounterConnectionState, 'fa-times': addEncounterConnectionState}"
                    (click)="toggleAddEncounterConnectionState()"></i>
                    <i [ngClass]="{'fa icon fa-1-5x ': true, 'fa-check': addEncounterConnectionState}" (click)="createEncounterConnection()"></i>
                </form>


                <div *ngFor="let character of encounter.encounterConnections; let i = index" class="icon-container">
                    <a routerLink="/character/{{character.character_details.name}}">
                        {{character.character_details.name}}
                    </a>
                    <i class="fa fa-trash icon ml-3" (click)="deleteEncounterConnection(character)"></i>
                </div>
            </div>
        </div>

        <div class="mb-1">
            <app-textfield 
            [initialText]="encounter.description"
            [heading]="'Description'"
            (updateText)="onEncounterUpdate($event)"
            ></app-textfield>
        </div>

        <app-delete-toggle (deleteEvent)="deleteEncounter()"></app-delete-toggle>

    </article>
    <ng-template #loading class="mb-4"> <app-spinner></app-spinner> </ng-template> 
</div>